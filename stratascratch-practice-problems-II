/* stratascratch.com Practice Problems II*/

/*Find the most profitable company from the financial sector. Output the result along with the continent.*/
/*forbes_global_2010_2014 Table:
company:        varchar
sector:         varchar
industry:       varchar
continent:      varchar
country:        varchar
marketvalue:    float
sales:          float
profits:        float
assets:         float
rank:           int
forbeswebpage:  varchar */

SELECT company, continent
FROM forbes_global_2010_2014
WHERE sector = 'Financials'
HAVING MAX(profits);


/*Count the number of companies in the Information Technology sector in each country.
Output the result along with the corresponding country name.
Order the result based on the number of companies in the descending order./*
/*forbes_global_2010_2014 Table:
company:        varchar
sector:         varchar
industry:       varchar
continent:      varchar
country:        varchar
marketvalue:    float
sales:          float
profits:        float
assets:         float
rank:           int
forbeswebpage:  varchar */

SELECT country, COUNT(sector) AS num_of_companies
FROM forbes_global_2010_2014
WHERE sector = 'Information Technology'
GROUP BY country
ORDER BY num_of_companies DESC;


/*Find the average profit for major banks.*/
/*forbes_global_2010_2014 Table:
company:        varchar
sector:         varchar
industry:       varchar
continent:      varchar
country:        varchar
marketvalue:    float
sales:          float
profits:        float
assets:         float
rank:           int
forbeswebpage:  varchar */

SELECT AVG(profits) AS average_profit
FROM forbes_global_2010_2014
WHERE industry = "Major Banks";


/* Find the total cost of each customer's orders. Output customer's id, first name, and the total order cost. 
Order records by customer's first name alphabetically.*/
/* customers Table:
id:            int
first_name:    varchar
last_name:     varchar
city:          varchar
address:       varchar
phone_number:  varchar
-------------------------
orders Table:
id:                int
cust_id:           int
order_date:        datetime
order_details:     varchar
total_order_cost:  int */

SELECT customers.id, customers.first_name, SUM(orders.total_order_cost) AS total_cost
FROM customers
JOIN orders
ON customers.id = orders.cust_id
GROUP BY customers.id
ORDER BY customers.first_name ASC;


/* Find the last time each bike was in use. Output both the bike number and the date-timestamp of the bike's last use (i.e., the date-time the bike was returned). 
Order the results by bikes that were most recently used. */
/*dc_bikeshare_q1_2012 Table:
duration:          varchar
duration_seconds:  int
start_time:        datetime
start_station:     varchar
start_terminal:    int
end_time:          datetime
end_station:       varchar
end_terminal:      int
bike_number:       varchar
rider_type:        varchar
id:                int */

SELECT bike_number, MAX(end_time ) AS last_used
FROM dc_bikeshare_q1_2012
GROUP BY bike_number
ORDER BY last_used DESC;


/* Find the gender that has made the most number of doctor appointments.
Output the gender along with the corresponding number of appointments. */
/*medical_appointments Table:
patientid:       float
appointmentid:   int
gender:          varchar
scheduledday:    datetime
appointmentday:  datetime
age:             int
neighbourhood:   varchar
scholarship:     int
hipertension:    int
diabetes:        int
alcoholism:      int
handcap:         int
sms_received:    int
no_show:         varchar */

SELECT gender, COUNT(appointmentid) AS num_of_appointments
FROM medical_appointments
GROUP BY gender
ORDER BY num_of_appointments DESC
LIMIT 1;
